#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

require 'shellwords'
require 'optparse'

dirs, op = [], "mv"

options = OptionParser.new do |opt|
  opt.banner = "USAGE: fehmove [options] [feh-args]\n\nOptions:\n"
  opt.on('-c', '--copy') { op = 'cp' }
  opt.on('-d', '--dir DIR') { |d| dirs << d if Dir.exists? d and File.writable? d }
end

args = options.parse ARGV
actions = dirs.flat_map.with_index { |d,i| ["--action#{i+1}", "#{op} -- %F #{d.shellescape}"] }
exec 'feh', '-Smtime', '--draw-actions', *actions, *args
