#!/usr/bin/env ruby
# encoding: utf-8
#
# Copyright (c) 2010 Sung Pae <sung@metablu.com>
# Distributed under the MIT license.
# http://www.opensource.org/licenses/mit-license.php

require 'optparse'

class Genpw
  def initialize args = []
    @args, @opts = args, {}
    @alpha = ('a'..'z').to_a + ('A'..'Z').to_a + ('0'..'9').to_a
    @ascii = (0x20..0x7e).map &:chr # ASCII printable chars
  end

  def options
    OptionParser.new do |opt|
      opt.summary_width = 16
      opt.banner = %Q{\
        Generate a random string of given length(s).

        Usage: #{File.basename __FILE__} [options] length ...

        Options:
      }.gsub /^ +/,''

      opt.on '-a', '--alpha', 'Alphanumeric characters only' do
        @opts[:alpha] = true
      end
    end
  end

  def password len
    chars = @opts[:alpha] ? @alpha : @ascii
    (1..len).map { chars[rand chars.length] }.join
  end

  def run
    args = options.parse @args
    args << 60 if args.empty?
    print args.map { |a| password a.to_i }.join("\n")
    puts if $stdout.tty?
  end
end

Genpw.new(ARGV).run if __FILE__ == $0
