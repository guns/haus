#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-
#
# Copyright (c) 2015-2017 Sung Pae <self@sungpae.com>
# Distributed under the MIT license.
# http://www.opensource.org/licenses/mit-license.php

require 'csv'
require 'fileutils'

URL = 'https://download.dnscrypt.info/resolvers-list/v2/public-resolvers.md'
SIG = 'https://download.dnscrypt.info/resolvers-list/v2/public-resolvers.md.minisig'

def verify file
  system 'minisign', '-Vm', file, '-P', 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
end

Dir.chdir '/tmp' do
  begin
    [URL, SIG].each { |u| system 'curl', '--silent', '-O', u }
    abort unless verify File.basename(URL)
    puts File.read(File.basename URL)
  ensure
    FileUtils.rm_f [URL, SIG].map { |f| File.basename f }
  end
end
