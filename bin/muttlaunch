#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

if system 'killall -0 mutt &>/dev/null'
  abort
else
  keybindings = File.read(File.expand_path '~/.inputrc').scan(/"\\e(.)":\s*"(.+)".*\bU\+[0-9a-fA-F]{4,6}\b/).map do |k,c|
    ['-e', %Q(macro editor "\\e#{k}" #{c})]
  end.flatten
  exec ({ 'LD_LIBRARY_PATH' => '/opt/notmuch/lib' }), 'mutt', '-n', *(ARGV + keybindings)
end
