#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

CACHE_DIR = '/var/cache/pacman/pkg'
HOSTNAME = ENV['HOSTNAME'] || %x(hostname).chomp

Dir.chdir CACHE_DIR do
  packages = Dir['*.pkg.tar.xz']

  packages.each do |pkg|
    unless File.exists? pkg + '.sig'
      system 'gpg', '--detach-sign', pkg
    end
  end

  system 'repo-add', '--new', '--sign', "#{HOSTNAME}.db.tar.gz", *packages
end
