#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

require 'webrick'

if ARGV.include? '-h' or ARGV.size > 1
  puts "Usage: httpget [path]\n\nTranslate an HTTP GET request into a curl request."
  exit
end

req = WEBrick::HTTPRequest.new WEBrick::Config::HTTP
req.parse $stdin
cmd = %W[curl --progress-bar --location --user-agent #{req.header["user-agent"].first || "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.90 Safari/537.36"}]
cmd << "-o" << ARGV.first unless ARGV.empty?
cmd << req.request_uri.to_s
warn cmd.inspect
exec *cmd
