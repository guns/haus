#!/usr/bin/env ruby
# -*- encoding: utf-8 -*-

require 'resolv'

if ARGV.size < 2
  abort "USAGE: #{File.basename $0} user@host domain â€¦"
end

remote, *domains = ARGV

addrs = domains.flat_map do |d|
  as = Resolv.getaddresses d
  as.empty? ? [d] : as
end.uniq

cmd = %W[sshuttle --verbose --listen 127.0.0.1:4 --remote #{ARGV[0]}] + addrs

puts cmd.join(" ")
exec *cmd
