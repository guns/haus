
#   __
#  |  |_.--------.--.--.--.--.
#  |   _|        |  |  |_   _|
#  |____|__|__|__|_____|__.__|  guns <sung@metablu.com>
#

display-message 'Loading tmux configuration'

### Options

set-option -gw set-titles on
set-option -gw set-titles-string '#U ❦ #H ❦ #W' # #U is a custom escape
set-option -gw clock-mode-style 24
set-option -gw mode-keys vi
set-option -gw mode-mouse on
set-option -gw window-status-format '#I #W#F'
set-option -gw window-status-current-format '#I #W#F'

set-option -g mouse-resize-pane on
set-option -g mouse-select-pane on
set-option -g mouse-select-window on
set-option -g mouse-utf8 on
set-option -g set-clipboard on
set-option -g status-left ''
set-option -g status-right '#U@#H' # #U is a custom escape
set-option -g status-utf8 on
set-option -g utf8 on

set-option -g escape-time 0
set-option -g display-time 1000
set-option -g display-panes-time 5000
set-option -g repeat-time 5000

set-option -g update-environment \
    "DISPLAY SSH_ASKPASS SSH_AUTH_SOCK SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY \
    GPG_AGENT_INFO DBUS_SESSION_BUS_ADDRESS"

# Custom terminfo
set-option -g default-terminal 'tmux-256color'
set-option -g terminal-overrides \
    "screen*:XT, \
      ,tmux*:XT, \
     ,xterm*:XT:Ms=\\E]52;%p1%s;%p2%s\\007:Cc=\\E]12;%p1%s\\007:Cr=\\E]112\\007:Cs=\\E[%p1%d q:Csr=\\E[2 q, \
      ,rxvt*:XT:Ms=\\E]52;%p1%s;%p2%s\\007:Cc=\\E]12;%p1%s\\007:Cr=\\E]112\\007:Cs=\\E[%p1%d q:Csr=\\E[2 q"

### Keybindings

# Rebind escape prefix
set-option -g prefix C-Space
bind-key C-Space send-prefix
unbind-key Space
unbind-key C-b

# Reload configuration
bind-key C-r    source ~/.tmux.conf

# Command line
bind-key \;     command-prompt

# Window management
bind-key -r ]   next-window
bind-key -r [   previous-window
bind-key -r {   swap-window -s: -t:-
bind-key -r }   swap-window -s: -t:+
bind-key C      command-prompt 'new-window "%%"'
bind-key ,      command-prompt 'rename-window "%%"'
bind-key X      confirm-before -p "kill-window #W? (y/n)" kill-window
bind-key %      command-prompt 'move-window -t "%%"'
bind-key .      run-shell 'ruby -e "%x(tmux list-windows).lines.map(&:to_i).each_with_index { |i,n| system %Q(tmux move-window -d -s #{i} -t #{n}) unless i == n }"'

# Panel management
bind-key h      select-pane -L
bind-key j      select-pane -D
bind-key k      select-pane -U
bind-key l      select-pane -R
bind-key -r C-h select-pane -L
bind-key -r C-j select-pane -D
bind-key -r C-k select-pane -U
bind-key -r C-l select-pane -R
bind-key -r H   resize-pane -L 1
bind-key -r J   resize-pane -D 1
bind-key -r K   resize-pane -U 1
bind-key -r L   resize-pane -R 1
bind-key -r M-h swap-pane -d -s: -t:.-
bind-key -r M-j swap-pane -D
bind-key -r M-k swap-pane -U
bind-key -r M-l swap-pane -d -s: -t:.+
bind-key @      join-pane -t :-
bind-key s      split-window
bind-key v      split-window -h
bind-key S      command-prompt 'split-window "%%"'
bind-key V      command-prompt 'split-window -h "%%"'
unbind-key u
unbind-key U

# Copy / Paste
bind-key /      copy-mode
bind-key \      copy-mode
bind-key C-b    copy-mode -u
bind-key C-p    paste-buffer

# Macros
bind-key e      new-window 'vim --servername EDITSERVER' \; rename-window 'EDITSERVER'
bind-key E      split-window -h 'vim --servername EDITSERVER'
bind-key h      new-window 'TERM=screen-256color htop'
bind-key i      new-window 'TERM=screen-256color weechat-curses' \; rename-window 'irc'
bind-key m      split-window -l 1 'cd ~/Downloads; exec muttlaunch -f' \; swap-pane -U
bind-key M      new-window 'offlineimaplaunch' \; rename-window 'Mail'
bind-key n      new-window 'cd ~/Downloads; TERM=screen-256color newsbeuter'
bind-key o      split-window -d -l 1 'offlineimaplaunch'
bind-key p      new-window 'pianobar' \; run-shell '[[ -p ~/.config/pianobar/ctl ]] || exit; sleep 0.2; printf "self@sungpae.com\n$(pass pandora.com/self@sungpae.com)\n" > ~/.config/pianobar/ctl'
bind-key P      new-window 'cd ~/Media/Music; TERM=screen-256color exec cmus'
bind-key f      new-window 'vidir' \; rename-window 'vidir'
bind-key F      split-window -h 'vidir'

### Colors

set-option -g status-attr none
set-option -g status-bg colour234
set-option -g status-fg colour252

set-option -g status-left-attr none
set-option -g status-left-bg colour234
set-option -g status-left-fg colour252

set-option -g status-right-attr none
set-option -g status-right-bg colour234
set-option -g status-right-fg colour252

set-option -gw window-status-attr none
set-option -gw window-status-bg colour234
set-option -gw window-status-fg colour252

set-option -gw window-status-current-attr bold,italics
set-option -gw window-status-current-bg colour0
set-option -gw window-status-current-fg colour252

set-option -gw window-status-activity-attr italics
set-option -gw window-status-activity-bg colour96
set-option -gw window-status-activity-fg colour0

set-option -gw window-status-bell-attr italics
set-option -gw window-status-bell-bg colour96
set-option -gw window-status-bell-fg colour0

set-option -gw window-status-content-attr italics
set-option -gw window-status-content-bg colour96
set-option -gw window-status-content-fg colour0

set-option -g message-attr italics
set-option -g message-bg colour96
set-option -g message-fg colour0

set-option -gw mode-attr none
set-option -gw mode-bg colour96
set-option -gw mode-fg colour0

set-option -g pane-border-bg colour0
set-option -g pane-border-fg colour236

set-option -g pane-active-border-bg colour0
set-option -g pane-active-border-fg colour96

set-option -g display-panes-active-colour colour252
set-option -g display-panes-colour colour96

set-option -gw clock-mode-colour colour96
