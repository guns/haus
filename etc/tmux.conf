
#   __
#  |  |_.--------.--.--.--.--.
#  |   _|        |  |  |_   _|
#  |____|__|__|__|_____|__.__|  guns <sung@metablu.com>
#


display 'Loading tmux configuration'        # Message if we are being re-sourced


### Options

set -gw set-titles on                       # Hardstatus titles
set -gw set-titles-string '#H ❦ #W'
set -gw clock-mode-style 24
set -gw mode-keys vi
set -gw mode-mouse on                       # Use mouse in copy mode
set -gw window-status-format '#I #W#F'
set -gw window-status-current-format '#I #W#F'

set -g mouse-resize-pane on
set -g mouse-select-pane on
set -g mouse-select-window on
set -g mouse-utf8 on
set -g set-clipboard on
set -g status-left ''
set -g status-right '❦ #(echo $USER)@#H ❦'  # Decorative corner for damn quartz-wm resize widget
set -g status-utf8 on
set -g utf8 on

set -g escape-time 5000                     # Escape prefix timeout
set -g display-time 2000                    # Message timeout
set -g display-panes-time 5000              # Panel numbers timeout
set -g repeat-time 5000                     # Command chaining timeout

set -g default-terminal 'tmux-256color'     # Use custom terminfo + tmux extensions
set -g terminal-overrides "screen*:XT,tmux*:XT, \
                           ,xterm*:XT:Ms=\\E]52;%p1%s;%p2%s\\007:Cc=\\E]12;%p1%s\\007:Cr=\\E]112\\007:Cs=\\E[%p1%d q:Csr=\\E[2 q, \
                            ,rxvt*:XT:Ms=\\E]52;%p1%s;%p2%s\\007:Cc=\\E]12;%p1%s\\007:Cr=\\E]112\\007:Cs=\\E[%p1%d q:Csr=\\E[2 q"


### Keybindings

# Rebind escape prefix
set -g prefix C-Space
bind C-Space send-prefix
unbind Space
unbind C-b

# Reload configuration
bind C-r    source ~/.tmux.conf

# Command line
bind \;     command-prompt

# Window management
bind -r ]   next-window
bind -r [   previous-window
bind -r {   swap-window -s: -t:-
bind -r }   swap-window -s: -t:+
bind C      new-window -d
bind n      command-prompt 'new-window "%%"'
bind ,      command-prompt 'rename-window "%%"'
bind m      command-prompt 'move-window -t "%%"'
bind X      confirm-before -p "kill-window #W? (y/n)" kill-window
bind %      command-prompt 'move-window -t "%%"'
bind .      run-shell 'i=0; tmux list-windows | while read w; do n=${w%%:*}; ((i == n)) || tmux move-window -d -s $n -t $i; ((++i)); done'

# Panel management
bind h      select-pane -L
bind j      select-pane -D
bind k      select-pane -U
bind l      select-pane -R
bind -r C-h select-pane -L
bind -r C-j select-pane -D
bind -r C-k select-pane -U
bind -r C-l select-pane -R
bind -r H   resize-pane -L 1
bind -r J   resize-pane -D 1
bind -r K   resize-pane -U 1
bind -r L   resize-pane -R 1
bind -r M-h swap-pane -d -s: -t:.-
bind -r M-j swap-pane -D
bind -r M-k swap-pane -U
bind -r M-l swap-pane -d -s: -t:.+
bind @      join-pane -t :-
bind s      split-window
bind v      split-window -h
bind C-v    split-window -h
bind S      command-prompt 'split-window "%%"'
bind V      command-prompt 'split-window -h "%%"'

# Copy / Paste
bind /      copy-mode
bind \      copy-mode
bind C-b    copy-mode -u
bind C-p    paste-buffer

# Job management
bind z      run-shell 'tmux list-panes | grep -v "(active)$" | perl -pe "s/.*(%\d+)$/\1/g" | xargs -I @ tmux send-keys -t @ '
bind f      run-shell 'tmux list-panes | grep -v "(active)$" | perl -pe "s/.*(%\d+)$/\1/g" | xargs -I @ tmux send-keys -t @ fg'

# Macros
bind i      new-window 'TERM=screen-256color weechat-curses' \; rename-window irc
bind I      split-window -l 4 -v 'weechat-password -l 30 $({ nc -z 127.0.0.1 22222 >&2 && echo freenode-proxy; } || echo freenode) guns'
bind p      new-window 'pianobar'
bind P      new-window 'TERM=screen-256color cmus'
bind r      new-window -a -t 0 'sudo su' \; swap-window -s: -t:- \; rename-window root
bind R      split-window 'sudo su'
bind M-r    new-window 'ranger' \; rename-window 'ranger'
bind M-R    split-window 'ranger'


### Colors

set -g status-attr none
set -g status-bg   colour234
set -g status-fg   colour252

set -g status-left-attr none
set -g status-left-bg   colour234
set -g status-left-fg   colour252

set -g status-right-attr none
set -g status-right-bg   colour234
set -g status-right-fg   colour252

set -gw window-status-attr none
set -gw window-status-bg   colour234
set -gw window-status-fg   colour252

set -gw window-status-current-attr bold,italics
set -gw window-status-current-bg   colour0
set -gw window-status-current-fg   colour252

set -gw window-status-activity-attr italics
set -gw window-status-activity-bg   colour96
set -gw window-status-activity-fg   colour0

set -gw window-status-bell-attr italics
set -gw window-status-bell-bg   colour96
set -gw window-status-bell-fg   colour0

set -gw window-status-content-attr italics
set -gw window-status-content-bg   colour96
set -gw window-status-content-fg   colour0

set -g message-attr italics
set -g message-bg   colour96
set -g message-fg   colour0

set -gw mode-attr none
set -gw mode-bg   colour96
set -gw mode-fg   colour0

set -g pane-border-bg colour0
set -g pane-border-fg colour236

set -g pane-active-border-bg colour0
set -g pane-active-border-fg colour96

set -g display-panes-active-colour colour252
set -g display-panes-colour        colour96

set -gw clock-mode-colour colour96
